{"version":3,"file":"matrix.js","sources":["../src/matrix.js"],"sourcesContent":["/**\n * Matrix effect on a Canvas https://jcubic.github.io/cmatrix/\n *\n * Copyright (c) 2021-2023 Jakub T. Jankiewicz <https://jcubic.pl/me>\n * Released under MIT license\n *\n * The code was started at this Codepen https://codepen.io/jcubic/pen/rNeNwgB\n * And was based on code by Michael Goodman https://codepen.io/goodmanmr1/pen/jpPeRR\n *\n */\nvar katagana = gen_unicode(0x30A1, 0x30F6);\nvar hiragana = gen_unicode(0x3041, 0x3096);\n\n// ---------------------------------------------------------------\nclass Matrix {\n  constructor(canvas, {\n    chars = null,\n    font_size = 14,\n    width,\n    height,\n    font = 'monospace',\n    color,\n    background\n  } = {}) {\n    this._canvas = canvas;\n    if (this._canvas._matrix) {\n      this._canvas._matrix.stop();\n      this._canvas._matrix.clear();\n    }\n    this._canvas._matrix = this;\n    this._ctx = canvas.getContext('2d');\n    this._font_size = font_size;\n    this._drops = [];\n    this._color = color;\n    this._background = background;\n    this._font = font;\n    this._chars = chars ? chars : katagana.concat(hiragana);\n    this.resize(width, height);\n  }\n  random_char() {\n    return rnd(this._chars);\n  }\n  render_char(char, x, y) {\n    this._ctx.fillText(char, x, y);\n  }\n  start() {\n    if (this._run) {\n      return;\n    }\n    let frames = 0;\n    this._run = true;\n    const self = this;\n    (function loop() {\n      if (self._run) {\n        if (frames++ % 2 === 0) {\n          self.render(); // slower render\n        }\n        requestAnimationFrame(loop);\n      }\n    })();\n  }\n  stop() {\n    this._run = false;\n  }\n  reset() {\n    for (let x = 0; x < this._columns; x++) {\n      this._drops[x] = 255;\n    }\n  }\n  resize(width, height) {\n    this._width = width;\n    this._height = height;\n    this.clear();\n    this._canvas.width = width;\n    setTimeout(() => {\n      this._canvas.height = height;\n      this.reset();\n    }, 0);\n    this._columns = Math.round(width / this._font_size);\n  }\n  clear() {\n    this._ctx.fillStyle = this._background;\n    this._ctx.fillRect(0, 0, this._width, this._height);\n    this._ctx.fillStyle = this._color;\n    this._ctx.font = this._font_size + \"px \" + this._font;\n  }\n  fullscreen() {\n    if (!document.fullscreenElement) {\n      document.documentElement.requestFullscreen();\n    } else if (document.exitFullscreen) {\n      document.exitFullscreen();\n    }\n  }\n  render() {\n    this.clear();\n    for (let col = 0; col < this._drops.length; col++) {\n      const char = this.random_char();\n      const x = col * this._font_size;\n      const y = this._drops[col] * this._font_size;\n      this.render_char(char, x, y);\n      if (y > this._height && Math.random() > .975) {\n        this._drops[col] = 0;\n      }\n      this._drops[col]++;\n    }\n  }\n}\n\n// ---------------------------------------------------------------\n// :: Init code\n// ---------------------------------------------------------------\nfunction matrix(canvas, { chars = null,\n                          font_size = 14,\n                          exit = true,\n                          font = 'monospace',\n                          width = default_width(),\n                          height = default_height(),\n                          resize = true,\n                          color = '#0F0',\n                          mount = () => {},\n                          unmount = () => {},\n                          background = 'rgba(0, 0,0,0.05)'} = {}) {\n\n  const matrix = new Matrix(canvas, {\n    font_size: font_size,\n    chars,\n    font,\n    color,\n    background,\n    width,\n    height\n  });\n\n  let resize_handler;\n\n  if (resize) {\n    resize_handler = () => matrix.resize(width(), height());\n\n    window.addEventListener('resize', resize_handler);\n\n    if (screen?.orientation) {\n      screen.orientation.addEventListener('change', resize_handler);\n    }\n  }\n\n  canvas.classList.add('running');\n\n  matrix.start();\n  mount(matrix);\n\n  if (exit) {\n    return new Promise(function(resolve) {\n      window.addEventListener('keydown', function(e) {\n        var key = e.key.toLowerCase();\n        if (key === 'q' || key === 'escape') {\n          matrix.stop();\n          canvas.classList.remove('running');\n          if (resize_handler) {\n            window.removeEventListener('resize', resize_handler);\n            if (screen?.orientation) {\n              screen.orientation.removeEventListener('change', resize_handler);\n            }\n          }\n          setTimeout(() => {\n            unmount(matrix);\n            resolve();\n          }, 0);\n        }\n      });\n    });\n  }\n};\n\n\nexport default matrix;\n\n// ---------------------------------------------------------------\n// :: Utils\n// ---------------------------------------------------------------\nfunction gen_unicode(start, end) {\n  var chars = [];\n  for (var i = start; i <= end; ++i) {\n    chars.push(String.fromCharCode(i));\n  }\n  return chars;\n}\n\nmatrix.range = gen_unicode;\n\n// ---------------------------------------------------------------\nfunction rnd(array) {\n  return array[Math.floor(Math.random() * array.length)];\n}\n\n// ---------------------------------------------------------------\nfunction default_width() {\n  return window.innerWidth;\n}\n\n// ---------------------------------------------------------------\nfunction default_height() {\n  return window.innerHeight;\n}\n"],"names":["katagana","gen_unicode","hiragana","Matrix","canvas","chars","font_size","width","height","font","color","background","_canvas","this","_matrix","stop","clear","_ctx","getContext","_font_size","_drops","_color","_background","_font","_chars","concat","resize","array","Math","floor","random","length","char","x","y","fillText","_run","frames","self","loop","render","requestAnimationFrame","_columns","_width","_height","setTimeout","_this","reset","round","fillStyle","fillRect","document","fullscreenElement","exitFullscreen","documentElement","requestFullscreen","col","random_char","render_char","matrix","resize_handler","exit","default_width","default_height","mount","unmount","window","addEventListener","screen","_screen","orientation","classList","add","start","Promise","resolve","e","key","toLowerCase","remove","removeEventListener","_screen2","end","i","push","String","fromCharCode","innerWidth","innerHeight","range"],"mappings":";;;;;;;;;;;uSAUA,IAAIA,EAAWC,EAAY,MAAQ,OAC/BC,EAAWD,EAAY,MAAQ,OAG7BE,wBACQC,gEAQR,OAPFC,MAAAA,aAAQ,WACRC,UAAAA,aAAY,KACZC,IAAAA,MACAC,IAAAA,WACAC,KAAAA,aAAO,cACPC,IAAAA,MACAC,IAAAA,0BAEKC,QAAUR,EACXS,KAAKD,QAAQE,eACVF,QAAQE,QAAQC,YAChBH,QAAQE,QAAQE,cAElBJ,QAAQE,QAAUD,UAClBI,KAAOb,EAAOc,WAAW,WACzBC,WAAab,OACbc,OAAS,QACTC,OAASX,OACTY,YAAcX,OACdY,MAAQd,OACRe,OAASnB,GAAgBL,EAASyB,OAAOvB,QACzCwB,OAAOnB,EAAOC,qDAErB,kBAuJWmB,EAtJEd,KAAKW,QAuJLI,KAAKC,MAAMD,KAAKE,SAAWH,EAAMI,SADhD,IAAaJ,6BApJX,SAAYK,EAAMC,EAAGC,QACdjB,KAAKkB,SAASH,EAAMC,EAAGC,wBAE9B,eACMrB,KAAKuB,UAGLC,EAAS,OACRD,MAAO,MACNE,EAAOzB,eACH0B,IACJD,EAAKF,OACHC,IAAW,GAAM,GACnBC,EAAKE,SAEPC,sBAAsBF,GAL1B,yBASF,gBACOH,MAAO,uBAEd,eACO,IAAIH,EAAI,EAAGA,EAAIpB,KAAK6B,SAAUT,SAC5Bb,OAAOa,GAAK,0BAGrB,SAAO1B,EAAOC,mBACPmC,OAASpC,OACTqC,QAAUpC,OACVQ,aACAJ,QAAQL,MAAQA,EACrBsC,YAAW,WACTC,EAAKlC,QAAQJ,OAASA,EACtBsC,EAAKC,UACJ,QACEL,SAAWd,KAAKoB,MAAMzC,EAAQM,KAAKM,iCAE1C,gBACOF,KAAKgC,UAAYpC,KAAKS,iBACtBL,KAAKiC,SAAS,EAAG,EAAGrC,KAAK8B,OAAQ9B,KAAK+B,cACtC3B,KAAKgC,UAAYpC,KAAKQ,YACtBJ,KAAKR,KAAOI,KAAKM,WAAa,MAAQN,KAAKU,gCAElD,WACO4B,SAASC,kBAEHD,SAASE,gBAClBF,SAASE,iBAFTF,SAASG,gBAAgBC,0CAK7B,gBACOvC,YACA,IAAIwC,EAAM,EAAGA,EAAM3C,KAAKO,OAAOW,OAAQyB,IAAO,KAC3CxB,EAAOnB,KAAK4C,cACZxB,EAAIuB,EAAM3C,KAAKM,WACfe,EAAIrB,KAAKO,OAAOoC,GAAO3C,KAAKM,gBAC7BuC,YAAY1B,EAAMC,EAAGC,GACtBA,EAAIrB,KAAK+B,SAAWhB,KAAKE,SAAW,YACjCV,OAAOoC,GAAO,QAEhBpC,OAAOoC,2CAQlB,SAASG,EAAOvD,OAsBVwD,6DAZwD,OAVpCvD,MAAAA,aAAQ,WACRC,UAAAA,aAAY,SACZuD,KAAAA,oBACApD,KAAAA,aAAO,kBACPF,MAAAA,aAAQuD,UACRtD,OAAAA,aAASuD,UACTrC,OAAAA,oBACAhB,MAAAA,aAAQ,aACRsD,MAAAA,aAAQ,mBACRC,QAAAA,aAAU,mBACVtD,WAAAA,aAAa,sBAE/BgD,EAAS,IAAIxD,EAAOC,EAAQ,CAChCE,UAAWA,EACXD,MAAAA,EACAI,KAAAA,EACAC,MAAAA,EACAC,WAAAA,EACAJ,MAAAA,EACAC,OAAAA,IAKEkB,IACFkC,EAAiB,kBAAMD,EAAOjC,OAAOnB,IAASC,MAE9C0D,OAAOC,iBAAiB,SAAUP,aAE9BQ,qBAAAC,EAAQC,aACVF,OAAOE,YAAYH,iBAAiB,SAAUP,OAIlDxD,EAAOmE,UAAUC,IAAI,WAErBb,EAAOc,QACPT,EAAML,GAEFE,SACK,IAAIa,SAAQ,SAASC,GAC1BT,OAAOC,iBAAiB,WAAW,SAASS,OACtCC,EAAMD,EAAEC,IAAIC,iBACJ,MAARD,GAAuB,WAARA,EAAkB,UACnClB,EAAO5C,OACPX,EAAOmE,UAAUQ,OAAO,WACpBnB,EACFM,OAAOc,oBAAoB,SAAUpB,aACjCQ,qBAAAa,EAAQX,aACVF,OAAOE,YAAYU,oBAAoB,SAAUpB,GAGrDf,YAAW,WACToB,EAAQN,GACRgB,MACC,SAKZ,CAQD,SAAS1E,EAAYwE,EAAOS,WACtB7E,EAAQ,GACH8E,EAAIV,EAAOU,GAAKD,IAAOC,EAC9B9E,EAAM+E,KAAKC,OAAOC,aAAaH,WAE1B9E,CACR,CAUD,SAASyD,WACAI,OAAOqB,UACf,CAGD,SAASxB,WACAG,OAAOsB,WACf,QAfD7B,EAAO8B,MAAQxF"}